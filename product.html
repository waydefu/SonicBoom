<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>產品詳情 - SonicBoom</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root { --primary-gradient: linear-gradient(90deg, #00c6ff 0%, #0072ff 100%); --glass-bg: rgba(20, 30, 40, 0.7); }
        body { background: linear-gradient(135deg, #16222A 0%, #3A6073 100%); background-attachment: fixed; color: #ffffff; font-family: 'Noto Sans TC', sans-serif; min-height: 100vh; }
        .navbar { background: rgba(0, 0, 0, 0.8) !important; backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .brand-logo { font-family: 'Orbitron', sans-serif; letter-spacing: 2px; color: #00c6ff; text-shadow: 0 0 10px rgba(0, 198, 255, 0.8); }
        .product-image-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; text-align: center; height: 100%; display: flex; align-items: center; justify-content: center; }
        .product-image-card img { max-width: 100%; max-height: 400px; transition: transform 0.5s ease; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }
        .product-image-card:hover img { transform: scale(1.05) rotate(-5deg); }
        .product-info { background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .price-tag { font-size: 2rem; color: #00c6ff; font-weight: bold; text-shadow: 0 0 15px rgba(0, 198, 255, 0.4); }
        .btn-gradient { background: var(--primary-gradient); border: none; color: white; font-weight: bold; padding: 12px 30px; border-radius: 50px; transition: 0.3s; box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4); width: 100%; }
        .btn-gradient:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(0, 198, 255, 0.8); color: white; background: linear-gradient(90deg, #00c6ff 20%, #0072ff 100%); }
        .toast-container { position: fixed; top: 80px; right: 20px; z-index: 9999; }
        .toast-custom { background: rgba(0, 20, 40, 0.95); color: white; border-left: 4px solid #00c6ff; }
        .nav-tabs { border-bottom: 1px solid rgba(255,255,255,0.2); }
        .nav-link { color: #aaa; background: transparent; border: none; font-size: 1.1rem; padding: 15px 25px; }
        .nav-link.active { color: #00c6ff !important; background: transparent !important; border-bottom: 3px solid #00c6ff !important; font-weight: bold; }
        .tab-content { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 0 0 15px 15px; border: 1px solid rgba(255,255,255,0.1); border-top: none; }
        .table-dark { background: transparent !important; --bs-table-bg: transparent; }
        .table-dark td, .table-dark th { border-color: rgba(255,255,255,0.1); padding: 15px; }
        .text-label { color: #00c6ff; font-weight: bold; width: 30%; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top py-3">
        <div class="container">
            <a class="navbar-brand brand-logo fs-3" href="index.html"><i class="fa-solid fa-wave-square"></i> SonicBoom</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto ms-4"><li class="nav-item"><a class="nav-link" href="index.html">回首頁</a></li></ul>
                <div class="d-flex align-items-center gap-3">
                    <span id="user-display" class="badge bg-info bg-opacity-25 border border-info px-3 py-2" style="display:none;"></span>
                    <a href="cart.html" class="btn btn-outline-info rounded-circle px-3 py-2" title="我的購物車"><i class="fa-solid fa-cart-shopping"></i></a>
                    <a id="btn-login" class="btn btn-outline-light rounded-pill px-4" href="login.html">登入</a>
                    <button id="btn-logout" class="btn btn-outline-danger rounded-pill px-4" style="display:none;">登出</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container product-container mt-5 mb-5">
        <div class="row g-5">
            <div class="col-lg-6">
                <div class="product-image-card"><img id="p-img" src="" alt="Product"></div>
            </div>
            <div class="col-lg-6">
                <div class="product-info h-100 d-flex flex-column justify-content-center">
                    <h5 class="text-info letter-spacing-2" id="p-brand">SONICBOOM</h5>
                    <h1 class="product-title mb-2 fw-bold" id="p-name">Loading...</h1>
                    <p class="text-white-50" id="p-desc-short">正在讀取商品資訊...</p>
                    <div class="mb-4"><span class="price-tag" id="p-price">$0</span></div>
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="form-label text-white-50 small">數量</label>
                            <input type="number" class="form-control text-center" id="p-qty" value="1" min="1" max="5">
                        </div>
                        <div class="col-md-8">
                            <button class="btn btn-gradient" id="btn-add-cart"><i class="fa-solid fa-cart-shopping me-2"></i> 加入購物車</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-5">
            <div class="col-12">
                <ul class="nav nav-tabs" id="myTab">
                    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#desc">商品介紹</button></li>
                    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#spec">詳細規格</button></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="desc"><p id="p-desc-long" style="line-height: 1.8; color: #ddd;">商品詳細介紹載入中...</p></div>
                    <div class="tab-pane fade" id="spec"><table class="table table-dark table-hover"><tbody id="spec-table-body"></tbody></table></div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container"><div id="liveToast" class="toast toast-custom align-items-center"><div class="d-flex"><div class="toast-body fs-6"></div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        const firebaseConfig = { apiKey: "AIzaSyC-LcCfcPYCYAQZ7n45YCe6tCY_jb-ygvI", authDomain: "sonicboom-shop.firebaseapp.com", projectId: "sonicboom-shop", storageBucket: "sonicboom-shop.firebasestorage.app", messagingSenderId: "976804831944", appId: "1:976804831944:web:6ede6a95196478bd49bbfd", measurementId: "G-3FEKWL0QXZ" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        const products = {
            "wh-xm5": { name: "Sony WH-1000XM5", price: 10900, img: "images/wh-xm5.jpg", brand: "SONY FLAGSHIP", short: "無線降噪耳罩式耳機", desc: "搭載雙處理器與 8 個麥克風，實現前所未有的降噪效果。", specs: `<tr><td class="text-label">佩戴方式</td><td>耳罩式</td></tr><tr><td class="text-label">驅動單體</td><td>30mm</td></tr><tr><td class="text-label">防水</td><td>無</td></tr>` },
            "wf-xm5": { name: "Sony WF-1000XM5", price: 8990, img: "images/wf-xm5.jpg", brand: "SONY WIRELESS", short: "真無線降噪耳機", desc: "Sony 史上最強降噪真無線耳機。搭載全新 Dynamic Driver X 驅動單體，人聲更清晰。", specs: `<tr><td class="text-label">佩戴方式</td><td>入耳式</td></tr><tr><td class="text-label">驅動單體</td><td>8.4mm Dynamic Driver X</td></tr><tr><td class="text-label">防水</td><td>IPX4</td></tr>` },
            "wh-xm4": { name: "Sony WH-1000XM4", price: 7900, img: "images/wh-xm4.jpg", brand: "SONY CLASSIC", short: "經典降噪耳罩", desc: "經典可折疊設計，攜帶方便。HD 降噪處理器 QN1 提供優異的降噪效能。", specs: `<tr><td class="text-label">佩戴方式</td><td>耳罩式</td></tr><tr><td class="text-label">驅動單體</td><td>40mm</td></tr><tr><td class="text-label">防水</td><td>無</td></tr>` },
            "az80": { name: "Technics EAH-AZ80", price: 9900, img: "images/az80.jpg", brand: "TECHNICS HI-FI", short: "旗艦真無線耳機", desc: "Technics 當家旗艦，搭載 10mm 鋁合金振膜單體。支援 LDAC 高解析音訊。", specs: `<tr><td class="text-label">佩戴方式</td><td>入耳式</td></tr><tr><td class="text-label">驅動單體</td><td>10mm 鋁合金</td></tr><tr><td class="text-label">防水</td><td>IPX4</td></tr>` },
            "az100": { name: "Technics EAH-AZ100", price: 6500, img: "images/az100.jpg", brand: "TECHNICS PRO", short: "專業監聽耳機", desc: "採用獨家 10mm 磁流體振膜技術，提供極致的低頻下潛。", specs: `<tr><td class="text-label">佩戴方式</td><td>入耳式</td></tr><tr><td class="text-label">驅動單體</td><td>10mm 磁流體振膜</td></tr><tr><td class="text-label">防水</td><td>IPX4</td></tr>` },
            "wf-xm4": { name: "Sony WF-1000XM4", price: 5990, img: "images/wf-xm4.jpg", brand: "SONY SALE", short: "降噪豆", desc: "搭載整合處理器 V1，降噪效能更上一層樓。", specs: `<tr><td class="text-label">佩戴方式</td><td>入耳式</td></tr><tr><td class="text-label">驅動單體</td><td>6mm</td></tr><tr><td class="text-label">防水</td><td>IPX4</td></tr>` }
        };

        const params = new URLSearchParams(window.location.search);
        const productId = params.get('id') || "wh-xm5";
        const product = products[productId];

        if (product) {
            document.getElementById('p-img').src = product.img;
            document.getElementById('p-name').innerText = product.name;
            document.getElementById('p-brand').innerText = product.brand;
            document.getElementById('p-price').innerText = "$" + product.price.toLocaleString();
            document.getElementById('p-desc-short').innerText = product.short;
            document.getElementById('p-desc-long').innerText = product.desc;
            document.getElementById('spec-table-body').innerHTML = product.specs;
        }

        document.getElementById('btn-add-cart').addEventListener('click', () => {
            if(auth.currentUser) {
                const qty = document.getElementById('p-qty').value;
                localStorage.setItem('cartItem', productId); 
                localStorage.setItem('cartQty', qty);
                showToast(`成功加入購物車！ (${product.name})`);
                setTimeout(() => { window.location.href = "cart.html"; }, 1000);
            } else {
                showToast("請先登入會員才能購買！", "warning");
                setTimeout(() => { window.location.href = "login.html"; }, 1500);
            }
        });

        onAuthStateChanged(auth, (user) => {
            const userDisplay = document.getElementById('user-display');
            const btnLogin = document.getElementById('btn-login');
            const btnLogout = document.getElementById('btn-logout');
            if (user) {
                userDisplay.style.display = 'inline-block';
                userDisplay.innerHTML = `<i class="fa-solid fa-user-astronaut me-2"></i> ${user.email.split('@')[0]}`;
                btnLogin.style.display = 'none';
                btnLogout.style.display = 'inline-block';
            } else {
                userDisplay.style.display = 'none';
                btnLogin.style.display = 'inline-block';
                btnLogout.style.display = 'none';
            }
        });

        document.getElementById('btn-logout').addEventListener('click', () => { 
            if(confirm("確定要登出嗎？")) { 
                localStorage.removeItem('cartItem');
                localStorage.removeItem('cartQty');
                signOut(auth).then(() => { window.location.href = "index.html"; }); 
            } 
        });

        window.showToast = function(message, type='success') { const toastEl = document.getElementById('liveToast'); const toastBody = toastEl.querySelector('.toast-body'); toastBody.innerHTML = type === 'success' ? `<i class="fa-solid fa-circle-check text-info me-2"></i> ${message}` : `<i class="fa-solid fa-circle-exclamation text-warning me-2"></i> ${message}`; const toast = new bootstrap.Toast(toastEl); toast.show(); }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
